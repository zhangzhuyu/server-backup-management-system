<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.ly.cloud.backup.mapper.DatabaseMonitoringMapper">
    <!--数据库允许的最大连接数-->
    <select id="getOracleDatabaseMaxConnections" resultType="string">
        select value as max_connections
        from v$parameter where lower(name) ='processes'
    </select>

    <!--数据库允许的最大连接数-->
    <select id="getOracleDatabaseCurrentConnections" resultType="string">
        select count(*) as current_connections
        from v$process
    </select>

    <!--实例名称、数据库版本、数据库状态、实例状态-->
    <select id="getOracleDatabaseInfo" resultType="com.ly.cloud.backup.vo.DatabaseMonitoringVo">
        select instance_name,version,database_status,status as instance_status
        from v$instance
    </select>

   <!--获取数据库表空间信息-->
    <select id="getOracleDatabaseTablespace" resultType="com.ly.cloud.backup.vo.DatabaseMonitoringVo">
        select a.tablespace_name,b.autoextensible,total as amounts,(total - free) as usage_amount,
               total / (1024 * 1024 * 1024) as amounts_g,(total - free) / (1024 * 1024 * 1024) as usage_amount_g,
               TRUNC((total - free) / total, 4) * 100  as usage_rate
        from (select tablespace_name, sum(bytes) free
              from dba_free_space
              group by tablespace_name) a,
             (select tablespace_name, sum(bytes) total,autoextensible
              from dba_data_files
              group by tablespace_name,autoextensible) b
        where a.tablespace_name = b.tablespace_name and UPPER(a.tablespace_name) in ('SYSTEM')
        order by a.tablespace_name
    </select>



</mapper>